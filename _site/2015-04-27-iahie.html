<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>Indentation and hooks in Emacs - Blog - Greduan.com</title>
		<meta name="viewport" content="width=device-width">

		<link rel="stylesheet" href="/css/normalize.css">
		<link rel="stylesheet" href="/css/main.css">
	</head>
	<body>
		<header role="banner">
			<h1><a href="/">Greduan's Blog</a></h1>
		</header>

		<main role="main">

			<article class="post">
				<header>
					<h1>Indentation and hooks in Emacs</h1>
					<p>2015-05-29</p>
				</header>

				<p>I&#39;ve been using Emacs on and off for around half a year, maybe a little bit
more, more recently I&#39;ve been using it daily because I&#39;ve been using Org-mode
more and I&#39;ve been editing code with it.</p>
<p>Something that has always bothered me about Emacs is how dang difficult it is to
manage indentation configs and stuff like that.  I&#39;ve never been able to have a
nice clean way to have a per-filetype based indentation config.</p>
<p>This is coming from the perspective of an adept Vim user, as it isn&#39;t actually
<em>that</em> hard in Emacs, it&#39;s just tedious, while in Vim it&#39;s <a href="http://stackoverflow.com/a/1562645">just one line</a>.</p>
<p>For a while I was just using the <a href="http://editorconfig.org/">editorconfig</a> Emacs plugin, but it doesn&#39;t
work right, since it only checks the config for a file <em>once</em>, and that is when
the file is opened.  If the <code>.editorconfig</code> file changes you need to close/open
the file or close Emacs and open the file again.</p>
<p>BTW if you don&#39;t use editorconfig in your projects, this is a great chance to
start now.  It only makes sense to use it.</p>
<p>After a bit I started playing around with hooks.</p>
<p>Now for me the problem with hooks is that they&#39;re a bit verbose.  That&#39;s not
really a problem, it&#39;s just me not used to how verbose Lisp can get sometimes.</p>
<!--
Another problem is that sometimes a mode doesn't offer a hook for some reason.
Those can be a bit annoying to deal with, also I had trouble finding what the
name of the hook is.
-->
<p>I am here to help you out with Emacs hooks.</p>
<h2 id="searching-for-mode-hooks">Searching for mode hooks</h2>
<p>This is quite simple, if you&#39;re not familiar with Emacs&#39; built-in help system,
you really should look into it (<code>C-h C-h</code>).</p>
<p>Do <code>C-h v</code> to look for a variable, then start typing the name of the mode, let&#39;s
say <code>shell-script</code> and then press tab, or <code>?</code> works as well.  Probably one of
the last results you&#39;ll get is <code>shell-script-mode-hook</code>.  Try it for other modes
you&#39;re interested in, you&#39;ll probably be able to find them this way.</p>
<p>Now there are some caveats, apparently not all hooks are made equal.  For
example, <code>javascript-mode-hook</code> doesn&#39;t do anything, but <code>js-mode-hook</code> does,
even though the major mode is called <code>javascript-mode</code>.</p>
<h2 id="my-indentation-strategy">My indentation strategy</h2>
<p>Now it took me a bit, but I deviced a system that works pretty nicely and is not
very verbose for my tastes, it is a bit tedious though if you don&#39;t have
<a href="https://github.com/abo-abo/lispy">Lispy</a> or Paredit.</p>
<p>Anyway, the strategy I have is simple.  First I define a default indentation
setup:</p>
<pre><code class="lang-elisp">;; default
(setq-default tab-width 4)
(setq-default tab-stop-list (number-sequence 4 100 4))
(setq-default indent-tabs-mode 1)
</code></pre>
<p>You can find out what <code>tab-width</code>, <code>tab-stop-list</code> and <code>indent-tabs-mode</code> do
with <code>C-h v</code>, and about what <code>number-sequence</code> does with <code>C-h f</code>.</p>
<p>Those are some defaults that I want to have on every file for which I haven&#39;t
defined something else.</p>
<p>Next I define a utility function:</p>
<pre><code class="lang-elisp">(defun my-tabs-stuff (tabs length)
  (setq indent-tabs-mode tabs)
  (setq tab-width length)
  (setq tab-stop-list (number-sequence length 100 length)))
</code></pre>
<p>What this function does is it just tells the buffer in which it is being run if
we should use real tabs or fake/space tabs (<code>indent-tabs-mode</code>), then it goes on
to tell it how long a real tab should look (<code>tab-width</code>) and what Emacs should
treat as a tab when dealing with spaces (<code>tab-stop-list</code>).  That&#39;s all our
function does.</p>
<p>Then we go on to define hook functions, these are the functions we are going to
refer to as the function that gets called when the hook is triggered.</p>
<pre><code class="lang-elisp">(defun my-emacs-lisp-hook ()
  (my-tabs-stuff nil 2))
(defun my-shell-script-hook ()
  (my-tabs-stuff 1 4))
(defun my-js-hook ()
  (my-tabs-stuff 1 2))
</code></pre>
<p>So we are just defining one function per mode, which in my case only call one
function each, the function being <code>my-tabs-stuff</code> and passing it the arguments
for what I want as indentation settings in that mode.</p>
<p>Now all that&#39;s left is to add these functions to the hooks:</p>
<pre><code class="lang-elisp">(add-hook &#39;emacs-lisp-mode-hook &#39;my-emacs-lisp-hook)
(add-hook &#39;shell-script-mode-hook &#39;my-shell-script-hook)
(add-hook &#39;js-mode-hook &#39;my-js-hook)
;(setq js2-mode-hook js-mode-hook)
</code></pre>
<p>Note the last one, you can basically alias one mode&#39;s hooks to another&#39;s by
using something like what you see in the last line.</p>
<p>Hopefully that helps you out, I&#39;ve wasted too much time with Emacs figuring this
out, or not figuring it out and suffering the consequences.  So hopefully this
saves you some time. :)</p>

			</article>

		</main>

		<footer role="contentinfo">
			<a href="http://greduan.com">Greduan.com</a> - 
			<a href="https://github.com/greduan/greduan.blog">Website's source</a> -
			<a href="http://greduan.com/contact.html">Contact</a>
		</footer>
	</body>
</html>
